<!DOCTYPE html>
<html>
<head>
	<!-- <script>document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] + ':35729/livereload.js?snipver=1"></' + 'script>')</script> -->
	<!-- <script>document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] + ':35729/livereload.js?snipver=1"></' + 'script>')</script> -->
	<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
	<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script> -->
	<link href="css/d3js.css"  rel="stylesheet">
	<script src="https://d3js.org/d3.v4.min.js"></script>
</head>
<body>
<div class="main">
	<h1>Dashboard</h1>

	<!-- We will add the data table here -->
	<h2>Custom Data:</h2>
	<div class="row">
		<div id="custom-table">
		</div>
	</div>

	<!-- We will add the donut and table here -->
	<h2>Total value</h2>
	<div class="row">
		<div id="counter_table"></div>
		<div id="today"></div>
	</div>

	<!-- We will add barchart here -->
	<h2>Sales every month</h2>
	<div class="row">
		<div id="month">
		</div>
	</div>

	<!-- We will add the data table here -->
	<h2>Data</h2>
	<div class="row">
		<div id="table">
		</div>
	</div>

</div>



<script>

	data =
		[
			{year: "2013-01", value: 53, category: "pants"},
			{year: "2013-02", value: 165, category: "pants"},
			{year: "2013-03", value: 269, category: "pants"},
			{year: "2013-04", value: 344, category: "pants"},
			{year: "2013-05", value: 376, category: "shirt"},
			{year: "2013-06", value: 410, category: "shirt"},
			{year: "2013-07", value: 421, category: "shirt"},
			{year: "2013-08", value: 405, category: "shirt"},
			{year: "2013-09", value: 376, category: "shirt"},
			{year: "2013-10", value: 359, category: "shoes"},
			{year: "2013-11", value: 392, category: "shoes"},
			{year: "2013-12", value: 433, category: "shoes"},
			{year: "2014-01", value: 455, category: "shoes"},
			{year: "2014-02", value: 478, category: "shoes"}
		];

		customData = [
	{
	"Evaluater1": "5",
	"Evaluater2": "5",
	"Evaluater3": "4",
	"Evaluater4": "5"
	},
	{
	"Evaluater1": "5",
	"Evaluater2": "5",
	"Evaluater3": "5",
	"Evaluater4": "5"
	},
	{
	"Evaluater1": "5",
	"Evaluater2": "5",
	"Evaluater3": "5",
	"Evaluater4": "5"
	},
	{
	"Evaluater1": "5",
	"Evaluater2": "5",
	"Evaluater3": "5",
	"Evaluater4": "5"
	},
	{
	"Evaluater1": "4",
	"Evaluater2": "5",
	"Evaluater3": "4",
	"Evaluater4": "4"
	},
	{
	"Evaluater1": "5",
	"Evaluater2": "5",
	"Evaluater3": "3",
	"Evaluater4": "4"
	},
	{
	"Evaluater1": "5",
	"Evaluater2": "5",
	"Evaluater3": "4",
	"Evaluater4": "5"
	},
	{
	"Evaluater1": "5",
	"Evaluater2": "5",
	"Evaluater3": "3",
	"Evaluater4": "5"
	},
	{
	"Evaluater1": "5",
	"Evaluater2": "5",
	"Evaluater3": "1",
	"Evaluater4": "5"
	},
	{
	"Evaluater1": "5",
	"Evaluater2": "5",
	"Evaluater3": "5",
	"Evaluater4": "5"
	},
	{
	"Evaluater1": "5",
	"Evaluater2": "5",
	"Evaluater3": "5",
	"Evaluater4": "5"
	},
	{
	"Evaluater1": "5",
	"Evaluater2": "5",
	"Evaluater3": "3",
	"Evaluater4": "5"
	},
	{
	"Evaluater1": "2",
	"Evaluater2": "3",
	"Evaluater3": "3",
	"Evaluater4": "2"
	},
	{
	"Evaluater1": "5",
	"Evaluater2": "5",
	"Evaluater3": "5",
	"Evaluater4": "5"
	},
	{
	"Evaluater1": "5",
	"Evaluater2": "5",
	"Evaluater3": "5",
	"Evaluater4": "5"
	},
	{
	"Evaluater1": "5",
	"Evaluater2": "5",
	"Evaluater3": "5",
	"Evaluater4": "5"
	},
	{
	"Evaluater1": "4",
	"Evaluater2": "4",
	"Evaluater3": "3",
	"Evaluater4": "3"
	}
];



	var parseDate = d3.timeParse("%Y-%m");

	data.forEach(function(d) {
		// console.log( Date.parse( d.year ) );
		d.date = parseDate( d.year );
		d.value = +d.value; // + converts it to an int, optimized version
		// d.class = d.category;
	});


	var table = d3.select('#table').append('table');
	// var tbody = d3.select('#table').append('tbody'); // var tbody return the appended tbody
	var	formatDate = d3.timeFormat("%Y-%m");

	var tbody = table.append('tbody')
	var tr = tbody.selectAll('tr')
		.data(data).enter()
		.append('tr')


	// var className = 'foo';
	// var className = function(d) { return d.category };
	var className = 'test-' + Math.random();

	tr.append('td').html(function(d) { return formatDate( d.date ); });
	// debugger;
	tr.append('td').html(function(d) { return d.category }).classed( 'foo', function() { return Math.random() > 0.5; } );
	// tr.append('td').html(function(d) { return d.category }).classed( className, true  );
	// debugger;
	tr.append('td').html(function(d) { return d.value });
	// debugger;

	var thead = table.append('thead').append('tr')

	thead.append('th').text("date");
	thead.append('th').text("category");
	thead.append('th').attr("class", "value").text("value");


	// Barchart:
	var month_margin = {top: 20, right: 40, bottom: 70, left: 20},
		month_width = 900,
		month_height = 400;


	var svg = d3.select("#month").append("svg")
		.attr("width", month_width + month_margin.left + month_margin.right)
		.attr("height", month_height + month_margin.top + month_margin.bottom)
		.append("g")
		// .attr("transform", "translate(" + month_margin.left + "," + month_margin.top + ")");
		.attr("transform", "translate(" + month_margin.left + "," + month_margin.top + ")");

	// var maxX = data[data.length-1].date;
	// var maxX = d3.timeMonth.offset( data[data.length-1].date, +1 );
	var maxX = d3.timeMonth.offset( data[data.length-1].date, +1 );
	var maxY = d3.max(data, function(d) { return d.value; });
	// console.log( d3.max(data, function(d) { return d.date } ) );
	// var x = d3.scaleTime().range([0, month_width]).domain([data[0].date, data[data.length-1].date]);
	var x = d3.scaleTime().range([0, month_width - 50]).domain([data[0].date, maxX]);
	var y = d3.scaleLinear().range([month_height, 0]).domain([0, maxY]);

	var rectWidth = 50;
	var rectWidth = month_width / data.length - 20;
	// var rectWidth = function(d) { return month_width - y(d.value); };

	function drawChart(category_name) {

		if (category_name) {
			console.log( category_name );
			// d3.select("#month svg").remove();

			filtered_data = data.filter(function(d){
				return d.category === category_name;
			});
		} else {
			filtered_data = data
		}
		svg.selectAll('rect').remove();
		// svg.selectAll('label').remove();

		svg.selectAll("rect")
			.data(filtered_data)
			.enter().append("rect")
			.attr("x", function(d) { return x(d.date); })
			// .attr("x", function(d) { return x(d.date); })
			.attr("width", rectWidth)
			// .attr("width", function(d) { return month_height - y(d.value); })
			.attr("y", function(d) { return y(d.value); })
			.attr("height", function(d) { return month_height - y(d.value); });


		// Add axis for y & x:
		var yAxis = d3.axisLeft()
			.scale(y)
			.tickSize(-month_width) //as wide as our graph
			.ticks(5);
		svg.append("g").attr("class", "y axis").call(yAxis)

		var xAxis = d3.axisBottom()
			.scale(x)
			.tickFormat(d3.timeFormat("%Y-%m"))
			.tickSize(-month_height) //as wide as our graph
			.ticks();
		svg.append("g")
			.attr("class", "x axis")
			.attr("transform", "translate(0," + month_height + ")")
			.call(xAxis);

		svg.selectAll("label")
			.data(data)
			.enter()
			.append("text")
			.attr("class", "label")
			// .style("fill", "#019875")
			.attr("y", function(d) { return y(d.value); })
			.attr("x", function(d) { return x(d.date); })
			.attr("dy", "-.35em") //vertical align middle
			.attr("dx", ".7em") //vertical align middle
			.text(function(d){ return d.value; });

	}

	drawChart();


	// Nesting results & Grouping results:
	var groupByCategory = d3.nest()
        .key(function(d) { return d.category; }).sortKeys(d3.ascending)
        .rollup(function(v) { return d3.sum(v, function(d) {return d.value;})})
        .entries(data);

	var counter_table = d3.select('#counter_table').append('table');

	var counter_thead = counter_table.append('thead').append('tr')

	counter_thead.append('th').text("category");
	counter_thead.append('th').attr("class", "value").text("value");

	var color = d3.scaleOrdinal()
		.range(["#D91E18", "#E87E04", "#F4D03F"]);

	var counter_tbody = counter_table.append('tbody')
	var counter_tr = counter_tbody.selectAll('tr')
		.data(groupByCategory).enter()
		.append('tr')
		.style("background-color", function(d) {
        	return color(d.key);
		})
		.on('click', function(d){
			drawChart(d.key)
		});

	counter_tr.append('td').html(function(d) { return d.key; });
	counter_tr.append('td').html(function(d) { return d.value });
	counter_tr = counter_tbody.selectAll('tr')
		.data(groupByCategory).enter()
		.append('tr')
		// .style('background-color','pink');


	// Making a 'donut'
	const donut_width = 250,
        donut_height = 250,
        donut_radius = 125;

	var donut_svg = d3.select("#today").append("svg")
	    .attr("width", donut_width)
	    .attr("height", donut_height)

	var donut = donut_svg.append("g")
	    .attr("transform", "translate(" + donut_width / 2 + "," + donut_height / 2 + ")");

	var arc = d3.arc()
    	.outerRadius(donut_radius - 0)
    	.innerRadius(0);

	var pie = d3.pie()
        .value(function(d) { return d.value; });

	var g = donut.selectAll(".arc")
	    .data(pie(groupByCategory))
	    .enter().append("g")
	    .attr("class", "arc");

	g.append("path")
    	.attr("d", arc)
    	.style("fill", function(d) {
        	return color(d.data.key);
		});


	// d3.ready(function() {
		// $('#counter_table tr').click(function(e) {
		//
		// 	// console.log($(this).find('td').html());
		// 	var currentClick = $(this).find('td').html();
		//
		// 	$('#table').empty();
		//
		// 	var table = d3.select('#table').append('table');
		// 	var	formatDate = d3.timeFormat("%Y-%m");
		//
		// 	var tbody = table.append('tbody')
		// 	var tr = tbody.selectAll('tr')
		// 		.data(data).enter()
		// 		.append('tr');
		//
		//
		// 		tr.append('td').html(function(d) { return formatDate( d.date ); });
		// 		tr.append('td').html(function(d) { return d.category });
		// 		tr.append('td').html(function(d) { return d.value });
		//
		//
		// 	var thead = table.append('thead').append('tr');
		//
		// 	// thead.append('th').attr("class", "value").text("value");
		// 	// thead.append('th').text("category");
		// 	thead.append('th').text("date");
		//
		//
		// });
	// });

	// Custom Decipher Data

	// customData.forEach(function(d) {
	// 	d.Evaluater1 = +d.Evaluater1;
	// 	d.Evaluater2 = +d.Evaluater2;
	// 	d.Evaluater3 = +d.Evaluater3;
	// 	d.Evaluater4 = +d.Evaluater4;
	// });
	//
	// var table = d3.select('#custom-table').append('table');
	// var tbody = table.append('tbody')
	// var tr = tbody.selectAll('tr')
	// 	.data(customData).enter()
	// 	.append('tr');
	//
	// tr.append('td').html(function(d) { return d.Evaluater1 });
	// tr.append('td').html(function(d) { return d.Evaluater2 });
	// tr.append('td').html(function(d) { return d.Evaluater3 });
	// tr.append('td').html(function(d) { return d.Evaluater4 });



</script>

</body>
</html>
